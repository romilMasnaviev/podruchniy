DROP TABLE IF EXISTS reviews;
DROP TABLE IF EXISTS restaurants_criteria;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS restaurants;
DROP TABLE IF EXISTS criteria;

CREATE TABLE IF NOT EXISTS users
(
    id            BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    mobile_number VARCHAR(20) UNIQUE NOT NULL,
    username      VARCHAR(50) UNIQUE NOT NULL,
    email         VARCHAR(50) UNIQUE NOT NULL,
    password      VARCHAR(50)        NOT NULL
);

CREATE TABLE IF NOT EXISTS restaurants
(
    id      BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name    VARCHAR(50) NOT NULL,
    rating  REAL,
    cuisine SMALLINT,
    price   SMALLINT
);

CREATE TABLE IF NOT EXISTS criteria
(
    id   BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS restaurants_criteria
(
    restaurant_id BIGINT REFERENCES restaurants (id) ON DELETE CASCADE,
    criteria_id   BIGINT REFERENCES criteria (id) ON DELETE CASCADE,
    PRIMARY KEY (restaurant_id, criteria_id)
);

CREATE TABLE IF NOT EXISTS reviews
(
    id            BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    mark          REAL,
    comment       VARCHAR(200),
    restaurant_id BIGINT REFERENCES restaurants (id) ON DELETE CASCADE,
    owner_id      BIGINT REFERENCES users (id) ON DELETE CASCADE,
    criteria_id   BIGINT REFERENCES criteria (id) ON DELETE CASCADE
);
